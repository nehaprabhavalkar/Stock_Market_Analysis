<!DOCTYPE html>
<html>
    <head>
      <title>Stock Market Analysis</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" type="text/css" href="{{ url_for('static',filename='styles/style.css') }}">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
      <script src="https://d14fo0winaifog.cloudfront.net/plotly-basic.js"></script> 
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    {% include 'navbar.html' %}
      <div class="header">
        
              <h4 class="headertext">Graph for {{stock}}</h4>
              
      </div>
  </body>
  
  <div class="chart" id="bargraph">
      <script>
          var graphs = {{graphJSON | safe}};
          Plotly.plot('bargraph',graphs,{});
      </script>
  </div>     
  <div class="center1">
      
      <button class="bt" id="5Day" data-bs-toggle="button" autocomplete="off" onclick="display(this.id, '{{stock}}');highlight_button(this.id)">5Day</button>
         
      </div>

          <div class="center2"> 
              
              <button class="bt" id="1Month" data-bs-toggle="button" autocomplete="off" onclick="display(this.id, '{{stock}}');highlight_button(this.id)">1Month</button>
          
          </div>
          <div class="center3"> 
              
              <button class="bt" id="6Month" data-bs-toggle="button" autocomplete="off" onclick="display(this.id, '{{stock}}');highlight_button(this.id)">6Month</button>
             
          </div>
          <div class="center4"> 
             
              <button class="bt" id="1Year" data-bs-toggle="button" autocomplete="off" onclick="display(this.id, '{{stock}}');highlight_button(this.id)">1Year</button>
             
          </div>
              
</script>

<script>
  var setInnerHTML = function(elm, html) {
elm.innerHTML = html;
Array.from(elm.querySelectorAll("script")).forEach( oldScript => {
  const newScript = document.createElement("script");
  Array.from(oldScript.attributes)
    .forEach( attr => newScript.setAttribute(attr.name, attr.value) );
  newScript.appendChild(document.createTextNode(oldScript.innerHTML));
  oldScript.parentNode.replaceChild(newScript, oldScript);
});
}

   function display(clicked_id, stock_name) {

      // var req = new XMLHttpRequest();
      // var url = "/update";
      var send = {id : clicked_id, name : stock_name};

      // req.open("POST", url, true);

      // req.setRequestHeader("Content-type", "application/json");

      // req.onreadystatechange = function(){
      //     if(req.readyState == 4){
      //         if(req.status == 200){
                  
      //             //window.location.href = "/";

      //             var graphs = {{graphJSON | safe}};
      //             Plotly.plot('bargraph',graphs,{}); 

      //         }
      //     }
      // }
      
      // req.send(JSON.stringify(send));

      $.ajax({
      type: "POST",
      url: "/update",
      data: JSON.stringify(send),
      contentType: "application/json",
      dataType: 'json',
      success: function(result) {
          graphJSON = result.JSON
          console.log(result);
      } 
});

}


  function highlight_button(clicked_id) {
                
                var btn1 = document.getElementById("5Day");
                var btn2 = document.getElementById("1Month");
                var btn3 = document.getElementById("6Month");
                var btn4 = document.getElementById("1Year");

                btn1.className = "bt";
                btn2.className = "bt";
                btn3.className = "bt";
                btn4.className = "bt";

                if(clicked_id == "5Day")
                {
                  btn1.className = "bt-highlighted";
                }
                else if(clicked_id == "1Month")
                {
                  btn2.className = "bt-highlighted";
                }
                else if(clicked_id == "6Month")
                {
                  btn3.className = "bt-highlighted";
                }
                else if(clicked_id == "1Year")
                {
                  btn4.className = "bt-highlighted";
                }
               
              }
        
</script>

</html>